( GRAPHICS VERSION 3     < 9/23/85>140) EXIT                                                                            GRAPHICS MODES:                         0 = INVERT BITS ON SCREEN               1 = SET BITS                            2 = CLEAR BITS                          3 = INVERSE PATTERN TO SCREEN           4 = EOR PATTERN WITH SCREEN             5 = PUT PATTERN ON SCREEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      ( BOBP )                                                                 ( GRAPHICS LOAD BLOCK    <12/13/86>141) 5 TO WIDTH                              APPENDIX : ATASK ;                      MAIN     : MTASK ;                                                              CR                                      CR 150     LOAD \ zero page defs        CR 259     LOAD \ table drive YADDR     CR 153 178 THRU \ hline prims           CR 180 183 THRU \ vline fs bar          CR 185 187 THRU \ uscroll dscroll       CR 190 209 THRU \ char draw             CR 210 221 THRU \ gemit, gexpect, etc.  \      143 LOAD \ point line routine                                            APPENDIX  FORGET ATASK                  MAIN      6 TO WIDTH                                                            CR 223 227 THRU \ G." STRLEN etc.       \  275 275 THRU \ Brody character set   CR CR ." Graphics Package loaded" CR                                            6 TO WIDTH                              EXIT                                                                                                    ( LOAD CODE AND A FONT   <12/13/86>142)                                                                                                                                                                    141 LOAD \ the code                     275 LOAD \ Brody character set                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      ( bobp )                                                                 \ LOAD LINE ROUTINES     < 7/ 6/87>143                                                                                                                          230 239 THRU \ HPLOT DOT LINE                                                   FORGET $HPLOT \ remove heads                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           \ FAH                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ( HIGH-LEVEL WORDS       <11/25/85>146) EXIT                                    HCOLOR ( N -- )                               set current color                 SETMODE ( N -- )                              set graphics mode                 SETENDPTS ( X1 X2 -- )                        set current X end points          HLINE ( Y -- )                                draw horiz line within current          X end points                      VLINE ( Y1 Y2 -- )                            draw vertical line or bar               within current X end points       CDRAW ( ADDR X Y -- )                         draw character at [X,Y]           <GEMIT> ( CH -- )                             draw character at [GX,GY]                                                                                                                                                                                                                                                ( bobp )                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ( ZERO PAGE USAGE        <12/21/85>150) HEX MAIN                                                                          E0 CONSTANT GBASE      ( >Y address )   E2 CONSTANT GPATTERN   ( >pattern   )   E4 CONSTANT GFIG       ( >fig data  )                                           E8 CONSTANT &QUO       ( x offset )     EA CONSTANT &REM       ( bit num. )                                             VARIABLE GMODE 5 GMODE !                                                      DECIMAL EXIT                            --------------------------------------- Locations D0 through EF are not used    by MVP-PADS, to allow use of the        Applesoft ram floating-point and        graphics routines.                      These particular loactions are part of  the graphics scratch area.                                                                                                                                                                     (  PAI )                                                                 ( $YADDR SUBROUTINE      < 9/23/85>151) EXIT --- SEE 259-263 ----               \ entry: line# in X reg.                \ exit:  address in GBASE               \ all registers are preserved           HEX                                     CODE $YADDR                                PHA, TXA, # C0  AND, GBASE STA,                   .A LSR, .A LSR,                         GBASE ORA, GBASE STA,              TXA, GBASE 1+ STA, .A ASL,                   .A ASL, .A ASL,                         GBASE 1+ ROL, .A ASL,                   GBASE 1+ ROL, .A ASL,                   GBASE ROR,                              GBASE 1+ LDA, # 1F AND,                 # 20 ORA, GBASE 1+ STA,       PLA, RTS, C;                                                                 DECIMAL EXIT                            --------------------------------------- Note: only valid for 0 <= line# <= 191  BOMBS FORTH when -1 or 255                                                                                                                      ( YADDR code version     < 9/23/85>152) EXIT --- SEE 259-263 ----                                                       CODE YADDR ( y -- yaddr )                    XSAVE STX, BOT LDA, TAX,                ' $YADDR JSR,                           XSAVE LDX,                              GBASE    LDA, BOT    STA,               GBASE 1+ LDA, BOT 1+ STA,               NEXT JMP, C;                                                               EXIT                                    --------------------------------------- Algorithm in Basic:                                                              INPUT Y                                 Y1 = INT(Y /8) : YR = Y  - Y1*8         Y2 = INT(Y1/8) : YS = Y1 - Y2*8         L  = 8192 + 40*Y2 + 128*YS + 1024*YR                                                                                                                                                                                                                                                                           ( BIT MASK TABLES        <12/21/85>153) HEX                                                                             \ CREATE BITTBL                         \        1 C,  2 C,  4 C,  8 C,         \       10 C, 20 C, 40 C, 80 C,                                                 CREATE LMASKS                                  7F C, 7E C, 7C C, 78 C,                 70 C, 60 C, 40 C, 00 C,                                                  CREATE RMASKS                                  01 C, 03 C, 07 C, 0F C,                 1F C, 3F C, 7F C, FF C,                                                  DECIMAL EXIT                                                                                                                                                                                                                                                                                                                                                   (  PAI )                                                                 ( $B/MOD unsigned divide < 9/23/85>154) \ 16bit/8bit --> 8bit,8bit              \ entry:                                \   "A" = lsb, "Y" = msb, "X" = divisor \ exit:                                 \   quotient in &QUO, remainder in &REM                                         XCODE $B/MOD N STX, ( divisor )                     &QUO STA, ( dividend lsb )              PHA, TYA, PHA, ( " msb )                # 8 LDY,                     BEGIN,     &QUO ASL,                               .A ROL,                                 N CMP,                        CS IF,    N SBC,                                  &QUO INC,                     THEN,     DEY,                         0= UNTIL,  &REM STA,                               PLA, TAY, PLA, RTS, XC;                                             EXIT                                                                                                                                                   ( BOBP )                                                                 ( $7/MOD 7/MOD B/MOD     < 9/23/85>155) EXIT                                                                            XCODE $7/MOD                                  N STA, TXA, PHA,                        N LDA, # 7 LDX,                         X' $B/MOD JSR,                          PLA, TAX, RTS, XC;                                                                                                CODE B/MOD ( 16bit 8bit -- 8bit 8bit )        XSAVE STX,                              SEC LDA, SEC 1+ LDY,                    PHA, BOT LDA, TAX, PLA,                 X' $B/MOD JSR,                          XSAVE LDX,                              # 0 LDY,                                &QUO LDA, BOT STA, BOT 1+ STY,          &REM LDA, SEC STA, SEC 1+ STY,          NEXT JMP, C;                                                              EXIT                                                                                                           ( BOBP )                                                                 ( COLORTAB notes         < 9/23/85>156)                                         EXIT                                    --------------------------------------- Each entry in COLORTAB is a nine-byte   block.                                  The first eight bytes form an 8-by-8    bit array that is expanded into         eight full scan lines.                  The ninth byte indicates whether the    color bit is turned on for each scan    line.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          ( BOBP )                                                                 ( COLORTAB               < 9/23/85>157) HEX \ solid colors                      CREATE COLORTAB                                                                 \ 0=black1                                    0000 , 0000 , 0000 , 0000 , 00 C, \ 1=violet                                    5555 , 5555 , 5555 , 5555 , 00 C, \ 2=green                                     AAAA , AAAA , AAAA , AAAA , 00 C, \ 3=white1                                    FFFF , FFFF , FFFF , FFFF , 00 C, \ 4=black2                                    0000 , 0000 , 0000 , 0000 , FF C, \ 5=blue                                      5555 , 5555 , 5555 , 5555 , FF C, \ 6=orange                                    AAAA , AAAA , AAAA , AAAA , FF C, \ 7=white2                                    FFFF , FFFF , FFFF , FFFF , FF C,                                         DECIMAL EXIT                                                                                                   ( BOBP )                                                                 ( COLORTAB CONTINUED     < 9/23/85>158) HEX                                     \ 8-15  small dot patterns              \ violet & black                        ( 8 ) 1144 , 1144 , 1144 , 1144 , 00 C, \ violet & white                        ( 9 ) DD77 , DD77 , DD77 , DD77 , 00 C, \ green & black                         ( 10) 8822 , 8822 , 8822 , 8822 , 00 C, \ green & white                         ( 11) BBEE , BBEE , BBEE , BBEE , 00 C, \ blue & black                          ( 12) 1144 , 1144 , 1144 , 1144 , FF C, \ blue & white                          ( 13) DD77 , DD77 , DD77 , DD77 , FF C, \ orange & black                        ( 14) 8822 , 8822 , 8822 , 8822 , FF C, \ orange & white                        ( 15) BBEE , BBEE , BBEE , BBEE , FF C, DECIMAL EXIT                                                                                                                                                                                   ( BOBP )                                                                 ( COLORTAB CONTINUED     < 9/23/85>159) HEX                                                                             \ four colors of gray                   ( 16) 33CC , 33CC , 33CC , 33CC , 00 C, ( 17) 9966 , 9966 , 9966 , 9966 , 00 C, ( 18) 33CC , 33CC , 33CC , 33CC , FF C, ( 19) 9966 , 9966 , 9966 , 9966 , FF C,                                         \ checks: white & xxx                   ( 20) 5F5F , 5F5F , F5F5 , F5F5 , 00 C, ( 21) AFAF , AFAF , FAFA , FAFA , 00 C, ( 22) 5F5F , 5F5F , F5F5 , F5F5 , FF C, ( 23) AFAF , AFAF , FAFA , FAFA , FF C,                                         \ vertical bars for Sally               ( 24) A8A8 , A8A8 , A8A8 , A8A8 , FF C,                                         DECIMAL                                                                         EXIT                                                                                                                                                   ( BOBP )                                                                 ( COLORTAB CONTINUED     < 9/23/85>160)                                         EXIT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   ( BOBP )                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ( $SETPATTERN VARS       <12/21/85>162)                                                                                 16384 CONSTANT PATBUF \ 42-byte buffer                                          CREATE TEMPLATE   9 ALLOT                                                       VARIABLE LEFT.D7     0 LEFT.D7 !        VARIABLE LEFT.MSK    0 LEFT.MSK !       VARIABLE RIGHT.D7    0 RIGHT.D7 !       VARIABLE RIGHT.MSK   0 RIGHT.MSK !                                              EXIT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   (  PAI )                                                                 ( $>PATBUF               < 9/23/85>163) \ all registers preserved               \ Xreg = y line #                       \ N    = color bit mask                 \ N 1+ = RIGHT.D7                       \ N 2+ = LEFT.D7                                                                XCODE $>PATBUF                                      PHA, TYA, PHA, TXA, PHA,                # 7 AND, TAX, ( y# mod 8 )                                                      RIGHT.D7 LDA, # 40 CMP,      CS IF,     # 39 LDA,                    THEN,      N 1+ STA,                               LEFT.D7 LDA, N 1+ CMP,       CS IF,     N 1+ LDA,                    THEN,      N 2+ STA,                                                                       ' PATBUF LDA,                           GPATTERN STA,                           ' PATBUF 1+ LDA,                        GPATTERN 1+ STA,                                                    EXIT ( more ... )              ( BOBP )                                                                 ( $>PATBUF continued     < 9/23/85>164)                                                     TEMPLATE 8 + LDA,                       BITTBL ,X AND,               0= NOT IF, # 128 LDA,                   THEN,      N STA,                                                                          TEMPLATE ,X LDA,                        # 39 LDY,                    BEGIN,     N 1+ CPY,                    0= NOT WHILE,                                      PHA, .A LSR,                            PLA, .A ROR,                            DEY,                         REPEAT,                                 BEGIN,     PHA, .A LSR, N ORA,                     PATBUF ,Y STA,                          PLA, .A ROR, N 2+ CPY,       0= NOT WHILE,                                      DEY,                         REPEAT,                                            PLA, TAX, PLA, TAY, PLA,                RTS, XC;                    EXIT                           ( BOBP )                                                                 ( SETPAT SETCOLOR        < 9/23/85>165)                                         VARIABLE COLOR#                                                                 : SETPAT ( ADDR -- )                             TEMPLATE 9 CMOVE ;                                                     : HCOLOR ( N -- )                                DUP COLOR# !                            9 * COLORTAB +                          SETPAT ;                                                               : SETMODE  ( N -- ) GMODE ! ;                                                   EXIT                                                                                                                                                                                                                                                                                                                                                                                                   ( BOBP )                                                                 \ $ORPAT SUBROUTINE      < 2/22/86>166                                          XCODE $ORPATB                                           GPATTERN )Y AND,                        GBASE )Y ORA,                           GBASE )Y STA,                           RTS, XC;                                                        XCODE $ORPAT                                           # 0 CPX,                   0= NOT IF,                                            GPATTERN )Y AND,            BEGIN,      GBASE )Y ORA,                           GBASE )Y STA,                           DEY,                                    DEX,                        0= NOT WHILE,                                       GPATTERN )Y LDA,            REPEAT,     LEFT.MSK LDA,             THEN,         X' $ORPATB JMP, XC;                                             EXIT                                                                                                                                                                                    ( $INVERT SUBROUTINE     < 9/23/85>167)                                         XCODE $INVERTB                                         GBASE )Y EOR,                           GBASE )Y STA,                           RTS, XC;                                                         XCODE $INVERT                                          # 0 CPX,                   0= NOT IF,                                BEGIN,     GBASE )Y EOR,                           GBASE )Y STA,                           # 127 LDA,                              DEY,                                    DEX,                         0= UNTIL,  LEFT.MSK LDA,              THEN,        X' $INVERTB JMP, XC;                                             EXIT                                                                                                                                                                                                                                   ( BOBP )                                                                 ( $TURNON SUBROUTINE     < 9/23/85>168)                                         XCODE $TURNONB                                         GBASE )Y ORA,                           GBASE )Y STA,                           RTS, XC;                                                         XCODE $TURNON                                          # 0 CPX,                   0= NOT IF,                                           GBASE )Y ORA,                BEGIN,     GBASE )Y STA,                           # 127 LDA,                              DEY,                                    DEX,                         0= UNTIL,  LEFT.MSK LDA,              THEN,        X' $TURNONB JMP, XC;                                             EXIT                                                                                                                                                                                                                                   ( BOBP )                                                                 ( $TURNOFF SUBROUTINE    < 9/23/85>169)                                         XCODE $TURNOFFB-                                       # 255 EOR,                              GBASE )Y AND,                           GBASE )Y STA,                           RTS, XC;                                                         XCODE $TURNOFF-                                        # 0 CPX,                   0= NOT IF,                                           # 255 EOR,                              GBASE )Y AND,                BEGIN,     GBASE )Y STA,                           # 0 LDA,                                DEY,                                    DEX,                         0= UNTIL,  LEFT.MSK LDA,              THEN,        X' $TURNOFFB- JMP, XC;                                           EXIT                                                                                                                                                   ( BOBP )                                                                 ( $INVPAT SUBROUTINE     < 9/23/85>170) XCODE $INVPATTB-                                       # 128 ORA, N STA,                       # 255 EOR, GBASE )Y AND,                N 1+ STA,                               GPATTERN )Y LDA,                        # 127 EOR,                              N AND, N 1+ ORA,                        GBASE )Y STA,                           RTS, XC;                                                         XCODE $INVPATT-                                        # 0 CPX,                   0= NOT IF,                                           X' $INVPATTB- JSR,           BEGIN,     DEY, DEX,                    0= NOT WHILE,                                      GPATTERN )Y LDA,                        # 127 EOR,                              GBASE )Y STA,                REPEAT,    LEFT.MSK LDA,              THEN,        X' $INVPATTB- JMP, XC;                                           EXIT                           ( BOBP )                                                                 ( $EORPAT SUBROUTINE     <12/21/85>171)                                         XCODE $EORPATB                                          # 128 ORA,                              GPATTERN )Y AND,                        GBASE )Y EOR,                           GBASE )Y STA,                           RTS, XC;                                                        XCODE $EORPAT                                          # 0 CPX,                   0= NOT IF,                                            # 128 ORA,                              GPATTERN )Y AND,            BEGIN,      GBASE )Y EOR,                           GBASE )Y STA,                           DEY,                                    DEX,                        0= NOT WHILE,                                       GPATTERN )Y LDA,            REPEAT,     LEFT.MSK LDA,             THEN,         X' $EORPATB JMP, XC;                                            EXIT                           (  PAI )                                                                 ( FILLPAT                <10/16/85>172)                                         XCODE $FILLPATB  # 128 ORA,                             N STA,                                  GBASE )Y LDA,                           GPATTERN )Y EOR,                        N AND,                                  GBASE )Y EOR,                           GBASE )Y STA,                           RTS, XC;                                                        XCODE $FILLPAT                                         # 0 CPX,                   0= NOT IF,                                            X' $FILLPATB JSR,           BEGIN,      DEY,                                    DEX,                        0= NOT WHILE,                                       GPATTERN )Y LDA,                        GBASE )Y STA,               REPEAT,     LEFT.MSK LDA,             THEN,         X' $FILLPATB JMP, XC;                                           EXIT                           ( FAH  )                                                                 ( $C-HLINE               <10/16/85>173) \ .A = draw mask (right mask if .x>0)   \ .X = byte count ( 0 => 1 byte )                                               CODE $C-HLINE                              PHA,                                    GMODE LDA, N STA, N INC,                PLA,                                    N DEC,                                  0= IF, X' $INVERT   JMP, THEN,          N DEC,                                  0= IF, X' $TURNON   JMP, THEN,          N DEC,                                  0= IF, X' $TURNOFF- JMP, THEN,          N DEC,                                  0= IF, X' $INVPATT- JMP, THEN,          N DEC,                                  0= IF, X' $EORPAT   JMP, THEN,                                                         X' $FILLPAT  JMP,                C;                                   EXIT                                                                                                           ( FAH  )                                                                 ( $HLINEB $HLINE         <10/16/85>174)                                         CODE $HLINEB   # 192 CPX,                 CS IF,       RTS,                       THEN,        TXA, PHA,                               RIGHT.MSK LDA,                          RIGHT.D7 LDY, # 40 CPY,    CS IF,       # 39 LDY, # 255 LDA,       THEN,        PHA, TYA,                               SEC, LEFT.D7 SBC,          CS IF,       TAX,                         0= IF,     PLA, LEFT.MSK AND,           ELSE,      PLA,                         THEN,      ' $C-HLINE JSR,            ELSE,        PLA,                       THEN,        PLA, TAX, RTS, C;                                                CODE $HLINE    # 192 CPX,                 CS IF,       RTS,                       THEN,        X' $>PATBUF JSR,                        ' $YADDR JSR,                           ' $HLINEB JMP, C;        EXIT                                                                   ( FAH  )                                                                 ( HLINEB  HLINE          <10/16/85>175) \ HLINE :                               \  draw horizontal line                 \  within current end points            \  "X" = y line #                                                               CODE HLINE ( y -- )                           XSAVE STX, BOT LDA, TAX,                ' $HLINE JSR,                           XSAVE LDX, POP JMP, C;                                                    \ HLINEB :                              \  draw horizontal line                 \  when pattern address                 \  {GPATTERN} has been                  \  previously computed                                                          CODE HLINEB ( y -- )                          TXA, PHA, BOT LDA, TAX,                 ' $YADDR JSR,                           ' $HLINEB JSR,                          PLA, TAX, POP JMP, C;                                                     EXIT                           ( FAH  )                                                                 ( $ENDPT                 <10/16/85>176) \ Entry:                                \ .A = endpt lo byte .Y = endpt hi byte \ Returns:                              \ .A = x byte offset .Y = x pix offset  \ CS = out of range  ( .X destroyed )                                           CODE $ENDPT # 0 CPY,       \ ? x < 0     0< IF,     # 0 LDA, # 0 LDY,                       SEC, RTS,                    THEN,                                              # 2 CPY,       \ ? x < 512   CS NOT IF, # 0 CPY,       \ ? x < 256     0= IF,   CLC,           \ ok...         ELSE,    # 24 CMP,      \ ? x < 280   THEN, THEN,                             CS IF,     # 39 LDA,      \ .. too big             # 6 LDY,                     ELSE,      # 7 LDX,                                X' $B/MOD JSR,                          &QUO LDA,  &REM LDY,                    CLC,                         THEN,      RTS, C;                                                    ( FAH  )                                                                 ( <ENDPT>                <10/16/85>177)                                         CODE <ENDPT> ( x -- bit byte )             XSAVE STX,                              BOT LDA, BOT 1+ LDY,                    ' $ENDPT JSR,                           XSAVE LDX,                              PHA,              \ for PUSH            BOT STY,          \ put bit#            # 0 LDA,                                BOT 1+ STA,       \ clear hi byte       PUSH JMP,         \ put byte#           C;                                                                           EXIT                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ( SETENDPTS              <12/21/85>178)                                         : SETENDPTS ( X1 X2 -- )                   DDUP > IF SWAP THEN                                                             0 MAX 279 MIN <ENDPT>  RIGHT.D7 !       RMASKS + C@ RIGHT.MSK !                                                         0 MAX 279 MIN <ENDPT>  LEFT.D7 !        LMASKS + C@ LEFT.MSK ! ;                                                                                             0 279 SETENDPTS                                                                 EXIT                                                                                                                                                                                                                                                                                                                                                                                                   (  PAI )                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ( CDELX XDELTA YDELTA etc<12/21/85>180)                                         1 CONSTANT CDELX    ( space between  )  0 CONSTANT CDELY    ( letters        )                                          VARIABLE ?HIBIT  \ 1 => use data hibit                                          VARIABLE CBYTES     ( width in bytes )  VARIABLE CWID   ( char width in bits )  VARIABLE CHGT      ( height in lines )                                             1 CBYTES !                              7 CWID !                                8 CHGT !                                                                     : XDELTA ( -- N )    \ width of            CWID C@ CDELX + ; \ last char drawn                                          : YDELTA ( -- N )    \ height of           CHGT C@ CDELY + ; \ last char drawn                                          EXIT                                                                                                           ( bobp )                                                                 ( VLINE                  < 9/25/85>181)   XVAR VY1                                XVAR VY2                                                                      XCODE $VLINE   TXA, PHA,                               VY1 LDX,                   BEGIN,       ' $HLINE JSR,                           VY2 CPX,                   CS NOT WHILE,                                        INX,                       REPEAT,      PLA, TAX, RTS, XC;                                               \ VLINE draw vertical line/bar          \       within current end points                                               : VLINE ( y1 y2 -- )                       DDUP > IF SWAP THEN                     0 MAX 191 MIN X' VY2 !                  0 MAX 191 MIN X' VY1 !                  X' $VLINE CALL ;                                                             : VBAR VLINE ;                                                                  EXIT                           ( BOBP )                                                                 ( -FS- FS                < 9/25/85>182)                                         \ fill screen with color                                                        : -FS-                                        FORGET-SYS                              0 279 SETENDPTS                         0 191 VLINE ;                                                             : FS ( n -- ) HCOLOR -FS- ;                                                     EXIT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           ( BOBP )                                                                 ( BAR                    <11/25/85>183)                                         : BBOUNDS ( x width -- xl xr )             -1 OVER +- + OVER + ;                                                                                                : BAR ( width height x y -- )              DOVER 0= SWAP 0= OR                     IF DDROP DDROP                          ELSE                                       ROT >R >R SWAP ( x w | y h )            BBOUNDS SETENDPTS                       R> R>                                   BBOUNDS VLINE                        THEN ;                                                                       EXIT                                                                                                                                                                                                                                                                                                                   ( bobp )                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ( GWIN margins GWINDOW:  <12/21/85>185)                                         : GETMODE GMODE C@ ;                                                                                                    0 CONSTANT GWIN \ revectorable                                                  : LMARG GWIN @ ;                        : TMARG GWIN 2+ @ ;                     : RMARG GWIN 4 + @ ;                    : BMARG GWIN 6 + @ ;                                                            : GWINDOW:                                 CREATE DOES> ' GWIN ! ;                                                      GWINDOW: FULLSCREEN                        0 , 0 , 279 , 191 ,                                                             FULLSCREEN \ set graphics window                                             EXIT                                                                                                                                                   ( bobp )   -->                                                           ( USCROLL                <12/21/85>186) \ scroll current window up                                                      : USCROLL ( -- )                           LMARG RMARG SETENDPTS                   GETMODE >R                              5 SETMODE                                  BMARG 1+  TMARG YDELTA +                DO                                         I YADDR GPATTERN !                      I YDELTA - HLINEB                    LOOP                                 2 SETMODE ( black )                        BMARG 1+ YDELTA - BMARG VLINE        R> SETMODE ;                                                                 EXIT                                                                                                                                                                                                                                                                                                                   ( bobp )                                                                 ( DSCROLL                <12/21/85>187) \ scroll current window down                                                    : DSCROLL ( -- )                           LMARG RMARG SETENDPTS                   GETMODE >R                              5 SETMODE                                  TMARG 1-  BMARG YDELTA -                DO                                         I YADDR GPATTERN !                      I YDELTA + HLINEB                    -1 +LOOP                             2 SETMODE ( black )                        TMARG DUP YDELTA + VLINE             R> SETMODE ;                                                                 EXIT                                                                                                                                                                                                                                                                                                                   ( bobp )                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ( V.3 CHARACTER DRAW     < 9/23/85>190) WIDTH 5 MAX ' WIDTH !                                                           : CTASK ;                                                                       EXIT                                    --------------------------------------- V.3 character draw                            character is surrounded                 on all sides by boundary                (determined by CDELX and CDELY)                                           Character Format:                                                                1 byte  Width in bits                   1 byte  Height in scan lines            N bytes character data;                         each scan line is                       left-justified on                       a byte boundary                                                        Usage:   <addr> <xpos> <ypos> CDRAW                                                                            ( BOBP )                                                                 ( CDRAW                  <11/25/85>191)                                          PATBUF XCONST    CHARBUF                                                        XVAR     CHX           ( x draw pos. )  XVAR     CHY           ( y draw pos. )                                          XVAR     C.RGT.D7                       XVAR     C.LFT.D7                       XVAR     C.LFT.MOD7                                                            EXIT                                                                            Other variables have been moved to      screen 180, to be used by GSCROLL                                                                                                                                                                                                                                                                                                                                                                      ( bobp )                                                                 ( $HIBIT                 < 9/23/85>192) \ GET HIGH BIT  (COLOR BIT)             \ FROM ORIGINAL LINE.                   \ MODIFY DATA BYTE AND                  \ STORE IN CHARBUF.                                                             XCODE $HIBIT                                           PHA,                                    ?HIBIT LDA,                0= IF,                                               PLA,                                    .A ASL,                                 PHA,                                    GBASE )Y LDA,                           .A ASL,                                 PLA,                                    .A ROR,                                 PHA,                       THEN,                                                PLA,                                    CHARBUF ,Y STA,                                                                 RTS, XC;                                                ( BOBP )                                                                 ( $CBYTE                 < 9/23/85>193)                                         XCODE $CBYTE                                           TXA, PHA,                               # 0 LDA,  N STA,                        GFIG )Y LDA,                            X' $HIBIT JSR,                          .A ASL,  PHP,                           C.LFT.MOD7 LDX,            BEGIN,       DEX,                       0< NOT WHILE,                                        .A ASL,  N ROL,            REPEAT,                                              PLP,  .A ROR,                           CHARBUF ,Y STA,                         # 39 CPY,                  0< IF,                                               CHARBUF 1+ ,Y LDA,                      N ORA,                                  CHARBUF 1+ ,Y STA,         THEN,                                                PLA, TAX,                               RTS, XC;                                                ( BOBP )                                                                 ( $CHLIN                 < 9/23/85>194)                                         XCODE $CHLIN                                           TYA, PHA,                                                                       # 0 LDA,                                RIGHT.D7 LDY,              BEGIN,                                               LEFT.D7 CPY,               0< NOT WHILE,                                        X' $HIBIT JSR,                          DEY,                       REPEAT,                                                                                      C.RGT.D7 LDY,              BEGIN,                                               C.LFT.D7 CPY,              0< NOT WHILE,                                        X' $CBYTE JSR,                          DEY,                       REPEAT,                                                                                                                                              ( BOBP )                                                                 ( $CHLIN cont'd          < 9/23/85>195)                                                        ' $YADDR JSR,                           ' $HLINEB JSR,                                                                  CLC,                                    CBYTES LDA,                             GFIG ADC,                   CS IF,      GFIG 1+ INC,                THEN,       GFIG STA,                                                                       PLA, TAY,                               RTS, XC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                ( BOBP )                                                                 ( $CLRLIN                < 9/23/85>196)                                         XCODE $CLRLIN                                          TYA, PHA,                               ' $YADDR JSR,                           # 0 LDA,                                LEFT.D7 LDY,              BEGIN,                                                X' $HIBIT JSR,                          RIGHT.D7 CPY,             0< WHILE,     INY,                      REPEAT,                                               ' $HLINEB JSR,                          PLA, TAY,                               RTS, XC;                                                         EXIT                                                                                                                                                                                                                                                                                                                   ( BOBP )                                                                 ( $CDRAW                 < 9/23/85>197)                                         XCODE $CDRAW                                           CHY LDX,                                                                        ' CDELY LDA, \ CLEAR TOP                .A LSR,      \ BORDER                   # 0 ADC,     \                          TAY,         \             BEGIN,       DEY,         \             0< NOT WHILE,             \                          X' $CLRLIN JSR, INX,       REPEAT,                   \                                                                  CHGT LDY,    \ DRAW CHAR   BEGIN,       DEY,         \             0< NOT WHILE,             \                          X' $CHLIN  JSR, INX,       REPEAT,                   \                                                   EXIT ( MORE... )                                                                                                                                       ( BOBP )                                                                 ( $CDRAW CONTINUED       <12/21/85>198)                                                        ' CDELY LDA, \ CLEAR                    .A LSR,      \ BOTTOM                                \ BORDER                   TAY,         \             BEGIN,       DEY,         \             0< NOT WHILE,             \                          X' $CLRLIN JSR, INX,       REPEAT,                                                                                      RTS, XC;                 EXIT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   (  PAI )                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ( $ENDPT                 <10/16/85>200) EXIT \ ENTRY:                           \ .A = ENDPT LO BYTE .Y = ENDPT HI BYTE \ RETURNS:                              \ .A = X BYTE OFFSET .Y = X PIX OFFSET  \ CS = OUT OF RANGE  ( .X DESTROYED )   CODE $ENDPT                                         # 0 CPY,                     0< IF,     # 0 LDA, # 0 LDY, SEC, RTS,  THEN,                                              # 2 CPY,    \ ? X < 512      CS NOT IF, # 0 CPY,    \ ? X < 256        0= IF,   CLC,        \ OK...            ELSE,    # 24 CMP,   \ ? X < 280      THEN, THEN,                             CS IF,     # 39 LDA,   \ .. TOO BIG                # 6 LDY,                     ELSE,      # 7 LDX,                                X' $B/MOD JSR,                          &QUO LDA,                               &REM LDY,                               CLC,                         THEN,      RTS, C;                                                    ( FAH  )                                                                 ( <CDRAW>                < 9/23/85>201) CODE <CDRAW> ( addr x y -- )                        # 3 LDA,                                SETUP JSR,                              XSAVE STX,                                                                      # 0 LDY,                                N 4 + )Y LDA,  \ GET WIDTH              CWID STA,      \ ..STORE IT             INY,                                    N 4 + )Y LDA,  \ GET HEIGHT             CHGT STA,      \ ..STORE IT                                                     CWID LDA,                     0= IF,    NEXT JMP, THEN,                         CHGT LDA,                     0= IF,    NEXT JMP, THEN,                                                                 CLC,                                    N 4 + LDA,     \ INCREMENT              # 2 ADC,       \ POINTER                N 4 + STA,     \              CS IF,    N 5 + INC, THEN,            EXIT                           ( BOBP )                                                                 ( CDRAW CONTINUED        < 9/23/85>202)                                         \ CHECK Y POSITION  ( Y 192 U< )                                                            SEC,        \ ASSUME FAIL               N 1+ LDA,   \ TOO BIG?        0= IF,    N LDA,                                  # 192 CMP,  \ TOO BIG?        THEN,                                   CS IF,                \ YES, TOO BIG              NEXT JMP,   \ DON'T DRAW      THEN,                                             CHY STA,    \ SAVE Y POS                                            EXIT                                    ---------------------------------------                                            N0 AND N1 ARE NOW AVAILABLE             FOR WHATEVER NEFARIOUS PURPOSE          I MAY HAVE IN MIND                                                                                                                                                                          ( BOBP )                                                                 ( CDRAW CONTINUED        < 9/23/85>203)                                         \ CHECK X POSITION  ( X 280 U< )                                                            N 2 + LDA,  \ LO BYTE ..                CHX STA,    \ .. STORE                  N 3 + LDY,  \ HI BYTE ..                CHX 1+ STY, \ .. STORE                                                          ' $ENDPT JSR,                 CS IF,                \ OUT OF RANGE              XSAVE LDX,  \                           NEXT JMP,   \ DON'T DRAW      THEN,                                             LEFT.D7 STA,                            LMASKS ,Y LDA,                          LEFT.MSK STA,                                                       EXIT                                    ---------------------------------------                                            N2 AND N3 ARE NOW AVAILABLE                                                                                 ( BOBP )                                                                 ( CDRAW CONTINUED        <12/21/85>204)                                         \ XPOS + CWID + CDELX                                                                       CHX LDA,                                CHX 1+ LDY,                             CLC,                                    CWID ADC,                     CS IF,    INY,                          THEN,                                             CLC,                                    ' CDELX ADC,                  CS IF,    INY,                          THEN,                                             ' $ENDPT JSR,                                                                   RIGHT.D7 STA,                           RMASKS ,Y LDA,                          RIGHT.MSK STA,              EXIT                                                                                                                                                                                           (  PAI )                                                                 ( CDRAW CONTINUED        <12/21/85>205)                                         \ XPOS + CDELX/2                                                                            ' CDELX LDA,                            .A LSR,                                 CLC,                                    CHX ADC,                                CHX 1+ LDY,                   CS IF,    INY,                          THEN,                                                                                     ' $ENDPT JSR,                           C.LFT.D7 STA,                           C.LFT.MOD7 STY,                                                     EXIT                                                                                                                                                                                                                                                                                                                   (  PAI )                                                                 ( CDRAW CONTINUED        < 9/23/85>206)                                         \ # BYTES DATA ON EACH SCAN LINE                                                            CLC,                                    CWID LDA,                               # 0 LDY,                                # 6 ADC,                      CS IF,    INY,                          THEN,     ' $ENDPT JSR,                                                                   CBYTES STA,                                                         EXIT                                                                                                                                                                                                                                                                                                                                                                                                                                           ( BOBP )                                                                 ( CDRAW CONTINUED        < 9/23/85>207)                                                     CLC,                                    C.LFT.D7 LDA,                           CBYTES ADC,                             SEC,                                    # 1 SBC,                                # 40 CMP,                     CS IF,    # 39 LDA,                     THEN,                                                                                     C.RGT.D7 STA,                                                       EXIT                                                                                                                                                                                                                                                                                                                                                                                                                                           ( BOBP )                                                                 ( CDRAW CONCLUDED        <11/25/85>208)                                         \ INITIALIZE GFIG AND GPATTERN                                                              SEC,                                    N 4 + LDA,                              C.LFT.D7 SBC,                           GFIG STA,                               N 5 + LDA,                              # 0 SBC,                                GFIG 1+ STA,                                                                    X' CHARBUF LDA,                         GPATTERN STA,                           X' CHARBUF 1+ LDA,                      GPATTERN 1+ STA,                                                                X' $CDRAW JSR,                                                                  XSAVE LDX,                              NEXT JMP, C;                                                        : CDRAW ( addr x y -- ) <CDRAW> ;       EXIT                           ( bobp )                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ( 17:13) ( ASCTAB                 <12/21/85>210)                                         : GTASK ;                                                                       0 CONSTANT ASCTAB                                                                 VARIABLE GX                             VARIABLE GY                                                                   : >COFFSET ( ch -- addr )                  2* ASCTAB + ;                                                                : >CDATA ( ch -- addr )                    >COFFSET @ ASCTAB + 270 + ;                                                  : CWIDTH ( ch -- n )                       >CDATA C@ ;                                                                                                          EXIT                                                                                                                                                                                           ( bobp )                                                        ( 17:13) ( @CURSOR !CURSOR        <12/21/85>211)                                         : !CURSOR ( x y -- ) GY ! GX ! ;        : @CURSOR ( -- x y ) GX @ GY @ ;                                                EXIT --------- moved to 185 ----------                                          : GETMODE GMODE C@ ;                                                            0 CONSTANT GWIN \ revectorable                                                  : LMARG GWIN @ ;                        : TMARG GWIN 2+ @ ;                     : RMARG GWIN 4 + @ ;                    : BMARG GWIN 6 + @ ;                                                            : GWINDOW:                                 CREATE DOES> ' GWIN ! ;                                                      GWINDOW: 0WINDOW \ full screen             0 , 0 , 279 , 191 ,                     0WINDOW \ set graphics window                                                                               ( bobp )   -->                                                           ( GHOME GPAGE CLW        < 2/ 4/86>212)                                         : GHOME  LMARG TMARG !CURSOR ;                                                  : CLW ( clear window )                     FORGET-SYS                              GETMODE                                    2 SETMODE                               LMARG RMARG SETENDPTS                   TMARG BMARG VLINE                    SETMODE ;                                                                    : GPAGE  GHOME CLW ;                                                            : GLF    YDELTA GY +! ;                                                         : GCR    GLF  LMARG GX ! ;                                                      EXIT                                    \ Note: GCR does not scroll at bottom   \ of screen                                                                                                                                            ( bobp )   -->                                                           ( <GEMIT> GEMIT          <12/21/85>213)                                         : <GEMIT> ( CH -- )                        DUP 128 <                               IF DUP >COFFSET @                          IF DUP >CDATA                              DUP @CURSOR CDRAW                       C@ CDELX + GX +!                  THEN THEN DROP ;                                                             : GEMIT <GEMIT> ;                                                                                                       EXIT                                    --------------------------------------  does not recognize carriage return,     line feed, back space, etc.             clips at right and bottom of screen                                                                                                                                                                                                                                            (  PAI )                                                                 ( MSS ?MSS GCURSE GKEY   <12/21/85>214)                                         \ : ?LEAVE IF R> LEAVE >R THEN ;                                                : MSS  0 DO 5 0 DO LOOP 1 /LOOP ;       : ?MSS 0 DO 4 0 DO LOOP                             QTERM ?LEAVE 1 /LOOP ;                                              100 CONSTANT #CURDELAY                                                          : <GCURSE>                                 @CURSOR BL GEMIT !CURSOR                #CURDELAY ?MSS ;                                                             : GCURSE <GCURSE> ;                                                             : <GKEY> ( -- ch )                         GETMODE >R 0 SETMODE                    BEGIN GCURSE GCURSE QTERM UNTIL         R> SETMODE <KEY> ;                                                           : GKEY <GKEY> ;                         EXIT                                                                   ( bobp )                                                                 ( <GBK> GPUTC            <12/21/85>215) \ for GINPUT                                                                    X: <GBK> ( addr pos ch -- addr pos )          GETMODE >R 4 SETMODE                    DROP DUP 0>                             IF 1- DDUP +                               DUP C@                                  BL ROT C!                               DUP >CDATA C@ CDELX +                      NEGATE GX +!                            GX @ >R                              <GEMIT>                                    R> GX !                           ELSE BEEP THEN                          R> SETMODE X;                                                             X: <GPUTC> ( addr pos ch -- addr pos )        DUP <GEMIT>                             3 PICK 3 PICK + C! 1+ X;                                                  EXIT                                                                                                           (  PAI )                                                                 \ GCTRL GBLANK           < 3/16/86>216                                          VARIABLE ?ESCAPE   1 ?ESCAPE !          VARIABLE ESC? \ true if escaped                                                 X: <GCTRL> ( addr pos ch -- addr pos )        DROP BEEP X;                                                              X: <GBLANK> ( addr pos ch -- addr pos )       OVER 0>                                 IF <GPUTC> ELSE <GCTRL> THEN X;                                                                                   \ GEXPECT is done when either           \ Return or Escape is pressed                                                   X: ?GDONE \ adr pos ch -- adr pos ch       DUP 13 =                                OVER 27 = ?ESCAPE @ AND DUP ESC? !      OR X;                                                                        EXIT                                                                                                           \ FAH                                                                    ( GEXPECT                <11/25/85>217)                                         : GEXPECT ( addr count -- )                DDUP BL FILL ( count ) >R               0  BEGIN                                      GKEY ?GDONE NOT                      WHILE                                      DUP 8 = OVER 127 = OR                      IF <GBK>    ELSE                     DUP BL <                                   IF <GCTRL>  ELSE                     OVER R@ < NOT                              IF <GCTRL>  ELSE                     DUP BL =                                   IF <GBLANK> ELSE                           <GPUTC>                           THEN THEN THEN THEN                  REPEAT ( ch ) DROP                   R> DROP DDROP ;                                                              EXIT                                                                                                                                                   ( bobp )                                                                 ( GINPUT                 <12/21/85>218)                                         \ like GEXPECT, but puts count byte     \ at start of string                                                            : GINPUT ( addr count -- )                 OVER 1+ OVER GEXPECT                    OVER 1+ SWAP -TRAILING                  ROT C! DROP ;                                                                                                        EXIT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ( GETN                   <12/21/85>219) VARIABLE GVAL \ max val is 32500        : GETN ( min max addr count -- val )      >R SWAP >R SWAP >R CR                   ( I=min I'=max J=count )                ( addr ) DUP J BL FILL 0 GVAL ! 0       BEGIN                                    BEGIN GKEY ?GDONE NOT                   WHILE DUP 8 = OVER 127 = OR              IF <GBK> GVAL @ 10 / GVAL !             ELSE OVER J < NOT                        IF <GCTRL>                              ELSE DUP ASCII 0 - DUP 10 U<             IF GVAL @ 10 * + DUP I' >                GVAL @ 3250 > OR ( no overflow)         IF DROP <GCTRL>                         ELSE GVAL ! <GPUTC> THEN               ELSE DROP <GCTRL> THEN THEN THEN     REPEAT GVAL @ I <                      WHILE ( 13 ) <GCTRL>                    REPEAT R> R> R> DDROP DDROP DDROP       GVAL @ ;                                                                      EXIT                                                                                                    ( GTYPE GSPACE GSPACES   <12/21/85>220)                                         : <GTYPE> ( addr count -- )                0 MAX ?DUP                              IF                                         0 DO COUNT GEMIT LOOP                THEN DROP ;                                                                  : GTYPE <GTYPE> ;                                                               : GSPACE  BL GEMIT ;                                                            : GSPACES 0 DO GSPACE LOOP ;                                                    EXIT                                                                                                                                                                                                                                                                                                                                                                                                   (  PAI )                                                                 ( G. GTAB                <12/21/85>221)                                         \ Print number on graphics screen.      \ Does not check for stack underflow.                                           : G. ( n dp -- )                           >R 0                                    <# R> ?DUP                                 IF 0 DO # LOOP 46 HOLD THEN          #S #> GTYPE ;                                                                                                        \ Tab over "n" char positions.          \ "8" has been arbitrarily chosen.                                              : GTAB ( n -- )                            8 * GX @ + 0 MAX 279 MIN GX ! ;                                              EXIT                                                                                                                                                                                                                                   (  PAI )                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ( G."                    <12/21/85>223) MAIN                                                                            : <G.">                                    R@ COUNT DUP 1+ R> + >R GTYPE ;                                              APPENDIX                                                                        : G."                                      'STREAM C@ 34 =                         IF 1 >IN +!                             ELSE                                       STATE @                                    IF COMPILE <G."> THEN                34 WORD DUP C@ 1+                       OVER + C@ 34 = NOT ?STREAM              STATE @                                    IF C@ 1+ ALLOT                          ELSE COUNT GTYPE THEN             THEN ; IMMEDIATE                                                             MAIN EXIT                                                                                                      (  PAI )                                                                 ( <STRLEN> STRLEN        < 2/22/86>224) \ returns the length L in pixels        \ of string at ADDR in pixels                                                   : <STRLEN> ( addr count -- l )             DUP                                     IF 0 SWAP   ( addr default count )         0 DO     ( addr length )                   >R COUNT CWIDTH R> +                    CDELX +                              LOOP                                 THEN                                    SWAP DROP CDELX - ;                                                          : STRLEN ( addr -- len )                   COUNT <STRLEN> ;                                                             EXIT                                                                                                                                                                                                                                                                           ( bobp )                                                                 ( <INBAR> <INXY>         <12/21/85>225)                                         282 CONSTANT XMULT ( for apple )                                                : <INBAR> \ runtime version               R> DUP 4 + >R                           DUP >R @ 0 XMULT U/MOD                  R> 2+ @ 0 XMULT U/MOD BAR ;                                                   \ inline storage of a constant          \ cursor position                                                               : <INXY>                                  R> DUP 2+ >R                            @ 0 XMULT U/MOD !CURSOR ;                                                                                                                                                                                                                                                                                                                                                                            (  PAI )                                                                 ( SNUM GETXY, INBAR INGXY<12/21/85>226) APPENDIX                                : SNUM BL WORD NUMBER DROP ;            : GETXY, \ read from stream and compile   SNUM SNUM XMULT * + , ;                                                         \ USE: INBAR w h x y                    \ compiles a consant bar              : INBAR                                   STATE @                                 IF   COMPILE <INBAR> GETXY, GETXY,      ELSE SNUM SNUM SNUM SNUM BAR            THEN                                    ; IMMEDIATE                                                                   \ USE: INGXY x y                                                                : INGXY                                   STATE @                                 IF   COMPILE <INXY> GETXY,              ELSE SNUM SNUM !CURSOR                  THEN ; IMMEDIATE                      MAIN                                                                   (  PAI )                                                                 ( GXYTAB                 <12/21/85>227)                                         : GXYTAB !CURSOR ;                      : GXY@   @CURSOR ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             (  PAI )                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ( $HPLOT                 < 9/23/85>230) \ plot point at {x,y}                   \ entry: .X = y coord                   \        .A = x coord lsb               \        .Y = x coord msb               \ registers not preserved                                                       XCODE $HPLOT                                        # 192 CPX,                    CS IF,    RTS,                          THEN,                                             N 2 + STA,                              N 3 + STY,                              N 4 + STX,                              ' $ENDPT JSR,                 CS IF,    RTS,                          THEN,                                             LEFT.D7 STA,                            LMASKS ,Y LDA,                          LEFT.MSK  STA,                                                      EXIT ( more ... )                                                                                              ( BOBP )                                                                 ( $HPLOT CONTINUED       <11/25/85>231)                                                                                             N 2 + LDA,                              N 3 + LDY,                              CLC, # 1 ADC,                 CS IF,    INY,                          THEN,                                             ' $ENDPT JSR,                           RIGHT.D7 STA,                           RMASKS ,Y LDA,                          RIGHT.MSK STA,                                                                  N 4 + LDX,                              ' $YADDR JSR,                           ' $HLINE JSR,                                                                   RTS, XC;                                                            EXIT                                                                                                                                                                                           ( bobp )                                                                 ( HPLOT                  < 9/23/85>232)                                         CODE HPLOT ( x y -- )                            XSAVE STX,                              SEC    LDA, PHA,    ( xlo )             SEC 1+ LDA, TAY,    ( xhi )             BOT    LDA, TAX,    ( ylo )             PLA,                                    X' $HPLOT JSR,                          XSAVE LDX,                              POPTWO JMP, C;                                                         EXIT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   ( BOBP )                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ( DOT                    < 9/23/85>234)                                         VARIABLE DOTX                           VARIABLE DOTY                                                                   XCODE <DOT>                                XSAVE STX,                              DOTX     LDA, ( x lsb )                 DOTX  1+ LDY, ( x msb )                 DOTY     LDX, ( y lsb )                 X' $HPLOT JSR,                          XSAVE LDX, NEXT JMP, XC;                                                     : DOT ( x y -- )                           DOTY ! DOTX ! <DOT> ;                                                        EXIT                                                                            : <1PLOT> <DOT> ;                                                                                                                                                                                                                      ( BOBP )                                                                 ( LINE -- HIGH LEVEL     < 9/23/85>235)                                         WIDTH 5 MAX ' WIDTH !                                                           VARIABLE LX1      VARIABLE LY1          VARIABLE LX2      VARIABLE LY2                                                  XVAR     LXTEM    XVAR     LYTEM                                                XVAR     DELSX    XVAR     DELDX        XVAR     DELSY    XVAR     DELDY        XVAR     DELSE    XVAR     DELDE                                                XVAR     DELS                           XVAR     DELP                           XVAR     LERR                                                                   XVAR     DCNT                                                                   EXIT                                                                                                                                                                                           ( BOBP )                                                                 ( BRES high level version<11/25/85>236)                                         X: BRES ( -- )                             LX1 @ DOTX !                            LY1 @ DOTY !                            DELS @ 1+ 0 DO                             <DOT>                                   LERR @ 0<                               IF                                         DELSE @ LERR +!                         DELSX @ DOTX +!                         DELSY @ DOTY +!                      ELSE                                       DELDE @ LERR +!                         DELDX @ DOTX +!                         DELDY @ DOTY +!                      THEN                                 LOOP X;                                                                      EXIT                                                                                                                                                                                           ( bobp )                                                                 ( BRESENHAM'S ALGORITHM  < 9/23/85>237)                                         X: BRESENHAM ( -- )                           LY2 @ LY1 @ -                           DUP 0< IF ABS -1 ELSE 1 THEN            DELDY ! DELP !                                                                  LX2 @ LX1 @ -                           DUP 0< IF ABS -1 ELSE 1 THEN            DELDX ! DELS !                                                                  DELS @ DELP @ <                         IF    DELS @ DELP @ DELS ! DELP !             0 DELSX ! DELDY @ DELSY !         ELSE  0 DELSY ! DELDX @ DELSX !         THEN                                                                            DELP @ 2* DUP DELSE !                   DELS @ -  DUP LERR  !                   DELS @ -      DELDE !                   BRES X;                           EXIT                                                                                                           ( BOBP )                                                                 ( LINE                   <11/30/85>238)                                         : LINE ( x1 y1 x2 y2 -- )                     LY2 ! LX2 ! LY1 ! LX1 !                 BRESENHAM ;                                                               : LINE-TO ( x3 y3 -- )                        LX2 @ LY2 @ DSWAP LINE ;                                                  EXIT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ( $BRES                  < 9/23/85>240) EXIT                                    --------------------------------------- \ code version                                                                  CODE $STRAIGHT                                      DELSE    LDA, CLC,                      LERR     ADC, LERR     STA,             DELSE 1+ LDA,                           LERR 1+  ADC, LERR 1+  STA,                                                     DELSX    LDA, CLC,                      DOTX     ADC, DOTX     STA,             DELSX 1+ LDA,                           DOTX  1+ ADC, DOTX  1+ STA,                                                     DELSY    LDA, CLC,                      DOTY     ADC, DOTY     STA,             DELSY 1+ LDA,                           DOTY  1+ ADC, DOTY  1+ STA,                                                     RTS,                        END-CODE                                                               ( BOBP )                                                                 ( $BRES CONTINUED        < 9/23/85>241) EXIT                                    --------------------------------------- \ code version                                                                  CODE $DIAGONAL                                      DELDE    LDA, CLC,                      LERR     ADC, LERR     STA,             DELDE 1+ LDA,                           LERR 1+  ADC, LERR 1+  STA,                                                     DELDX    LDA, CLC,                      DOTX     ADC, DOTX     STA,             DELDX 1+ LDA,                           DOTX  1+ ADC, DOTX  1+ STA,                                                     DELDY    LDA, CLC,                      DOTY     ADC, DOTY     STA,             DELDY 1+ LDA,                           DOTY  1+ ADC, DOTY  1+ STA,                                                     RTS,                        END-CODE                                                               ( BOBP )                                                                 ( $BRES continued        < 9/23/85>242) EXIT                                    --------------------------------------- \ code version                          \ registers are *NOT* preserved                                                 CODE $BRES                                          LX1     LDA, DOTX    STA,               LX1 1+  LDA, DOTX 1+ STA,               LY1     LDA, DOTY    STA,               LY1 1+  LDA, DOTY 1+ STA,                                                       DELS    LDA, DCNT    STA,               DELS 1+ LDA, DCNT 1+ STA,                                                       DCNT    INC,                 0= IF,     DCNT 1+ INC,                 THEN,                                                                          --> ( more ... )                                                                                                                                                                               ( BOBP )                                                                 ( $BRES cnt'd   <BRES>   < 9/23/85>243) EXIT                                    --------------------------------------- \ code version continued                                                         BEGIN,                                             ' $DOT   JSR,                                                                   LERR 1+  LDA,                   0< IF,  ' $STRAIGHT JSR,                ELSE,   ' $DIAGONAL JSR,                THEN,                                           DCNT     LDA,                   0= IF,  DCNT 1+  DEC,                   THEN,   DCNT     DEC,                           DCNT 1+  LDA,                0< UNTIL,  RTS,                        END-CODE                                                                                                                : <BRES>  ' $BRES CALL ;                                                                                                                               ( BOBP )                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ( INCLR                  < 9/23/85>247)                                         : TASK ;                                                                        : <INCLR>                                   R> DUP 1+ >R C@ HCOLOR ;                                                    : INCLR                                     BL WORD NUMBER DROP                     STATE @                                 IF COMPILE <INCLR> C,                   ELSE HCOLOR THEN                        ; IMMEDIATE                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ( BOBP )                                                                 ( INXY                   < 9/23/85>248)                                         : <INXY>                                    R> DUP 2+ >R @                          280 /MOD !CURSOR ;                                                          : INXY                                      BL WORD NUMBER DROP                     BL WORD NUMBER DROP                     STATE @                                 IF  280 * +                                 COMPILE <INXY> ,                    ELSE !CURSOR THEN                       ; IMMEDIATE                                                                                                                                                                                                                                                                                                                                                                                                                                ( BOBP )                                                                 ( INBAR                  < 9/23/85>249)                                         : <INBAR>                                   R> DUP 4 + >R                           DUP    @ 280 /MOD                       ROT 2+ @ 280 /MOD                       BAR ;                                                                       : INBAR                                     BL WORD NUMBER DROP                     BL WORD NUMBER DROP                     BL WORD NUMBER DROP                     BL WORD NUMBER DROP                     STATE @                                 IF  COMPILE <INBAR> DSWAP                   280 * + ,                               280 * + ,                           ELSE BAR THEN                           ; IMMEDIATE                                                                                                                                                                                                                        ( BOBP )                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 \ COMPUTED YADDR         < 1/16/86>258  \ SEE 259 TO LOAD TABLE DRIVEN VERSION                                                                                  \ load computed yaddr routine                                                   260 261 THRU                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           \ FAH                                                                    \ TABLE DRIVEN YADDR     < 1/16/86>259  \ SEE 258 TO LOAD COMPUTED VERSION                                              \ loading this screen will load         \ the table driven version of yaddr     \ load the next screen to use the       \ computed version                                                              CREATE LYADDR 256 ALLOT                 CREATE HYADDR 256 ALLOT                                                         260 261 THRU  \ to get addrs for table      262 LOAD  \ word to fill table      FILLTAB       \ fill the table          FORGET $YADDR \ forget old routine          263 LOAD  \ table drive $YADDR          261 LOAD  \ YADDR is same for both                                                                                                                                                                                                                                                                                                                                                          ( $YADDR SUBROUTINE      < 2/14/86>260) \ computes values                       \ entry: line# in X reg.                \ exit:  address in GBASE               \ all registers are preserved           HEX                                     CODE $YADDR                                PHA, TXA, # C0  AND, GBASE STA,                   .A LSR, .A LSR,                         GBASE ORA, GBASE STA,              TXA, GBASE 1+ STA, .A ASL,                   .A ASL, .A ASL,                         GBASE 1+ ROL, .A ASL,                   GBASE 1+ ROL, .A ASL,                   GBASE ROR,                              GBASE 1+ LDA, # 1F AND,                 # 20 ORA, GBASE 1+ STA,       PLA, RTS, C;                                                                 DECIMAL EXIT                            --------------------------------------- Note: only valid for 0 <= line# <= 191  BOMBS FORTH when -1 or 255                                                                                                                      ( YADDR code version     < 2/14/86>261)                                         CODE YADDR ( y -- yaddr )                    XSAVE STX, BOT LDA, TAX,                ' $YADDR JSR,                           XSAVE LDX,                              GBASE    LDA, BOT    STA,               GBASE 1+ LDA, BOT 1+ STA,               NEXT JMP, C;                                                               EXIT                                    --------------------------------------- Algorithm in Basic:                                                              INPUT Y                                 Y1 = INT(Y /8) : YR = Y  - Y1*8         Y2 = INT(Y1/8) : YS = Y1 - Y2*8         L  = 8192 + 40*Y2 + 128*YS + 1024*YR                                                                                                                                                                                                                                          ( bobp )                                                                 ( CREATE YADDR TABLES    < 2/14/86>262) \ this word will fill LYADDR and HYADDR \ with the proper values                                                        \ all values above 191 return the       \ address of the last scan line         \ to avoid crashes                                                                                                      : FILLTAB                                 192 0 \ do for the real values          DO I YADDR DROP                            GBASE C@ LYADDR I + C!                  GBASE 1+ C@ HYADDR I + C!            LOOP                                    \ fill remainder of table with adr      \ scan line 191 (already in GBASE)      256 192                                 DO GBASE C@ LYADDR I + C!                  GBASE 1+ C@ HYADDR I + C!            LOOP                                  ;                                                                                                              ( bobp )                                                                 ( $YADDR - TABLE DRIVEN  < 2/14/86>260) \ entry: line# in X reg.                \ exit:  address in GBASE               \ all registers are preserved           HEX                                     CODE $YADDR                               PHA,                                     LYADDR ,X LDA,                          GBASE STA,                              HYADDR ,X LDA,                          GBASE 1+ STA,                          PLA,                                    RTS,                                  C;                                      DECIMAL EXIT                            --------------------------------------- Note: only valid for 0 <= line# <= 191  returns addr of 191 for vals >191                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ( LOAD BRODY FONT        <11/25/85>275)                                         CR CR ." LOADING BRODY FONT " 2BEEP     CR CR 2BEEP                                                                     CREATE BRODYFONT 1624 ALLOT                                                     BRODYFONT ' ASCTAB !                                                                                                    BLK @ 1+ BLOCK ASCTAB        1024 CMOVE BLK @ 2+ BLOCK ASCTAB 1024 +  600 CMOVE                                                                                 EXIT                                                                                                                                                                                                                                                                                                                                                                                                   ( bobp ) U]U]U]www3;www3	               
     % 1 = R g                                                           	!-9EQ]r~&2GS_kw.:FR^s            	!-9EZfr~#  8	             	UUUUUUU  		p ~c~     	?  	?  		  @ @@@      	           	    Cco0 C3 6 _c       	         o	   o	       o		l l l l l     _	 ~ [ x [~    _
	[n 0 XlF    _	 6 <  3 s ^    _	        	   	   	 3?3    	 ?    	        	         	         	@` 0         _	33333   	   	308?   	3003   	 08<60   	?303   	833   	0   	3333   	33>   	        	       	     	        	     	30    	|3[[6    _	66c  	3333  	66  	33333  	  	  	6csf<  	333?333  	  	  	33  	  		Go;    _	CGO[scC    _	6ccc6  	333  	 6 c c s v \    _	3333   	303   	?   	333333   	CCf f < <      _		;oG    _	3333  	CCf <        _	?0?   	  nscsn   	;gcg;   	  33   	``nscsn   	  >c?~   	<?   	  nscsn`> 	;gccc   	    	  	33   	   
	    O3333    _	  3333  	  333  	  ;gcg;	  nscsn``	    	  >0  	?  	  3333>  	  cc66  
	    3333N    _	  33  	  33	  ??  	  	  	  		s              _		p ~c~                                                                                                                                                                                                                                                                                                                                                                                                                  	!	RGCUQQ6DANLQT"72)                          472                            # . 9 D O Z e p {             
 +6ALWbmx(3>IT_ju%0;FQ\gr}  	            	         	   	      	 




 	   	  		  	      	  	  	  	    	      	        	        	    	  	  	  	  	
	  	  	  	  	  	  	       	     	  	       	  	   	  	
  	  	  	  	  	  	  	  	  	  			  	  	  	  	  	  		  		  	  	  	  	
  	  	

  	
  	  	         	         	  	  
    	        	      	    	  	    	  	    	  	   	  	   	  			  	  	    	  				  	    	   	   	    	    	  	    	  
  	  
  	  

  	   	    	         	                 	         	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           