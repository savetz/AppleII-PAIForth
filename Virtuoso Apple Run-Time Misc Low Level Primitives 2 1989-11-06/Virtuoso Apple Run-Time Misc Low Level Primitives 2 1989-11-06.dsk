                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ( LOADBLOCK - DISK 2                             <11/ 6/89>141)                                                                 L64 ONLY FORTH ALSO DEFINITIONS                                 CR CR ." First word: FLEN (ASTART)" CR CR                                                                                       XCREATE ASTART                                                    150 179 THRU  \ record words                                    180 189 THRU  \ window record defintion                         190 199 THRU  \ Mouse stubs                                     200 204 THRU  \ Mouse cursor definitons                         205 209 THRU  \ DOT stubs                                       210 239 THRU  \ Event loop                                      240 244 THRU  \ File stubs                                      245 254 THRU  \ Font manager                                  FORGET ASTART                                                                                              ˜˜˜˜˜˜               èèèèèèèèèèèèèèèèèèèèëëëëëë74444444444444444444444444444444444444[ZXM4R»¦ ¼Ô´¹¦ºÕ±°³¼»¼ØÅÃÂß¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬¬ÊÃÞËÉØ FLEN                                            #########FORGET ASTART                                                                                                                                                                                   141 LOAD                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         üüüüüüüüüüüüüüD˜DD˜Dü üDü ü ü ü ü ˜D˜D˜D˜D˜DüD˜ ˜D˜D˜ ˜˜˜                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      ( record definition notes                        <10/31/89>150) EXIT ---------------------------------------------------------                                                                  No functional changes were made to this code during the         translation from IBM to Apple (The memory organization          differences are isolated in the long memory operators)                                                                          Oh well there was one change that has no effect now but might   be difficult to track down. When field access words are executedthe IBM copies the full WORD size, on the APPLE ONLY THE LOW    BYTE IS COPIED                                                                                                                                                                                                                                                                                                                                                                         ( fah  ) ( definitions for forth inner loop primitives    <10/31/89>151) EXIT                                                            next: # 1 LDY, IP )Y LDA, W 1+ STA,                                   DEY, IP )Y LDA, W STA,                                          CLC, IP LDA, # 2 ADC, IP STA, CS                                IF, IP 1+ INC, THEN, W 1- JMP C,                          nest: IP 1+ LDA, PHA, IP LDA, PHA,                                    CLC, W LDA, # 2 ADC, IP STA, TYA,                               W 1+ ADC, IP 1+ STA, NEXT JMP,                            exit: PLA, IP STA, PLA, IP 1+ STA, NEXT JMP,                    cons: DEX, DEX, # 2 LDY, W )Y LDA, BOT STA,                           INY, BOT 1+ STA, NEXT JMP,                                jump: adr_lo LDA, W STA, adr_hi LDA, W 1+ STA,                        W 1- JMP,                                                                                                                                                                                 ( Record definition example                      <10/31/89>152) 0 CONSTANT FLEN \ length of last field accessed                                                                                 EXIT                                                                                                                            RECORD: FORMAT                                                    2 FIELD: F-LINK  @WORD !WORD                                    8 FIELD: F-NAME  @NAME !NAME                                    1 FIELD: F-BG    @BYTE !BYTE                                  REND                                                                                                                                                                                                                                                                                                                                                                                                                                                            ( <@OPR>                                         <10/31/89>153)   \  2 [W] = @word cfa         10 [W] = parent                    \ 12 [W] = offset            14 [W] = length                                                                                  SUBR <@OPR> \ -- seg:adr, put field adr on stack call @word       DEX, DEX, DEX, DEX,           \ build seg in SEC, adr in BOT           \ address of parent in zptr                              # 10 LDY, W )Y LDA, zptr STA,                                   INY, W )Y LDA, zptr 1+ STA,                                            \ SEC=seg of LOC-TABLE                                   LOC-TABLE LDA, SEC STA,                                         LOC-TABLE 1+ LDA, SEC 1+ STA,                                          \ BOT=handle for rec * 2 .                               0 # LDY, zptr )Y LDA, .A ASL, BOT STA,                          INY, zptr )Y LDA, .A ROL, BOT 1+ STA,                                                                                         ( <@OPR> cont                                    <10/31/89>154)                                                                          \ SEC=base segment of resource                            from_mem JSR,                                                   N 2+ STX, N 2+ INC, N 2+ INC,     \ write to SEC                0 # LDY, N 3 + STY,               ( RAMWRT ignored)             # 2 LDA, N 4 + STA, # 1 LDA, N 5 + STA,                         ' transfer JSR,                                                       \ BOT = field_ofs + rec_ofs                               # 12 LDY, W )Y LDA, CLC,                                        # 2 LDY, zptr )Y ADC, BOT STA,                                  # 13 LDY, W )Y LDA, CLC,                                        # 3 LDY, zptr )Y ADC, BOT 1+ STA,                                                                                                                                                                                                                            ( <@OPR> cont                                    <10/31/89>154)                                                                          \ copy field length to FLEN                                     \ *** ONLY COPIES LO BYTE ****                            # 14 LDY, W )Y LDA, ' FLEN STA,                                       \ jump to @CFA                                            # 2 LDY, W )Y LDA, PHA,                                         INY, W )Y LDA, W 1+ STA,                                        PLA, W STA, # 0 LDY,                                            W 1- JMP, S;                                                                                                                                                                                                                                                                                                                                                                                                                                                 ( <!OPR>                                         <10/31/89>153)  \ 2 [BX] = !word cfa        6 [BX] = parent                     \ 8 [BX] = offset          10 [BX] = length                                                                                    SUBR <!OPR> \ -- seg:adr, put field adr on stack call @word       DEX, DEX, DEX, DEX,           \ build seg in SEC, adr in BOT           \ address of parent in zptr                              # 6 LDY, W )Y LDA, zptr STA,                                    INY, W )Y LDA, zptr 1+ STA,                                            \ SEC=seg of LOC-TABLE                                   LOC-TABLE LDA, SEC STA,                                         LOC-TABLE 1+ LDA, SEC 1+ STA,                                          \ BOT=handle for rec * 2 .                               0 # LDY, zptr )Y LDA, .A ASL, BOT STA,                          INY, zptr )Y LDA, .A ROL, BOT 1+ STA,                                                                                         ( <!OPR> cont                                    <10/31/89>154)                                                                          \ SEC=base segment of resource                            from_mem JSR,                                                   N 2+ STX, N 2+ INC, N 2+ INC,     \ write to SEC                0 # LDY, N 3 + STY,               ( RAMWRT ignored)             # 2 LDA, N 4 + STA, # 1 LDA, N 5 + STA,                         ' transfer JSR,                                                       \ BOT = field_ofs + rec_ofs                               # 8 LDY, W )Y LDA, CLC,                                         # 2 LDY, zptr )Y ADC, BOT STA,                                  # 9 LDY, W )Y LDA, CLC,                                         # 3 LDY, zptr )Y ADC, BOT 1+ STA,                                                                                                                                                                                                                            ( <!OPR> cont                                    <10/31/89>154)                                                                          \ copy field length to FLEN                                     \ *** ONLY COPIES LO BYTE ****                            # 10 LDY, W )Y LDA, ' FLEN STA,                                       \ jump to @CFA                                            # 2 LDY, W )Y LDA, PHA,                                         INY, W )Y LDA, W 1+ STA,                                        PLA, W STA, # 0 LDY,                                            W 1- JMP, S;                                                                                                                                                                                                                                                                                                                                                                                                                                                 ( <@LOC>                                         <10/31/89>159)   \ 2 [W] = parent             4 [W] = offset                     \ 6 [W] = length                                                                                                              SUBR <@LOC> \ -- seg:adr, put field adr on stack call @word       DEX, DEX, DEX, DEX,           \ build seg in SEC, adr in BOT           \ address of parent in zptr                              # 2 LDY, W )Y LDA, zptr STA,                                    INY, W )Y LDA, zptr 1+ STA,                                            \ SEC=seg of LOC-TABLE                                   LOC-TABLE LDA, SEC STA,                                         LOC-TABLE 1+ LDA, SEC 1+ STA,                                          \ BOT=handle for rec * 2 .                               0 # LDY, zptr )Y LDA, .A ASL, BOT STA,                          INY, zptr )Y LDA, .A ROL, BOT 1+ STA,                                                                                ( fah  ) ( <@LOC> cont                                    <10/31/89>160)                                                                          \ SEC=base segment of resource                            from_mem JSR,                                                   N 2+ STX, N 2+ INC, N 2+ INC,     \ write to SEC                # 0 LDY, N 3 + STY,               ( RAMWRT ignored)             # 2 LDA, N 4 + STA, # 1 LDA, N 5 + STA,                         ' transfer JSR,                                                       \ BOT = field_ofs + rec_ofs                               # 4 LDY, W )Y LDA, CLC,                                         # 2 LDY, zptr )Y ADC, BOT STA,                                  # 5 LDY, W )Y LDA, CLC,                                         # 3 LDY, zptr )Y ADC, BOT 1+ STA,                                                                                                                                                                                                                            ( <@LOC> cont                                    <10/31/89>154)                                                                          \ copy field length to FLEN                                     \ *** ONLY COPIES LO BYTE ****                            # 6 LDY, W )Y LDA, ' FLEN STA,                                        \ just exit with seg adr on stack                                                                                         NEXT JMP, S;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ( <@REC>                                         <10/31/89>162) \ -6 [BX] = handle location                                                                                                     SUBR <@REC> \ -- handle, get handle value for this record         DEX, DEX,                                                       SEC, W LDA, # 6 SBC, N STA,                                     W 1+ LDA, # 0 SBC, N 1+ STA,                                    N )Y LDA, BOT STA,                                              INY, N )Y LDA, BOT 1+ STA,                                      NEXT JMP, S;                                                                                                                                                                                                                                                                                                                                                                                                                                         ( fah  ) ( <!REC>                                         <10/31/89>163) \ -8 [BX] = handle location                                                                                                     SUBR <!REC> \ handle --, set handle value for this record         SEC, W LDA, # 8 SBC, N STA,                                     W 1+ LDA, # 0 SBC, N 1+ STA,                                    BOT LDA, N )Y STA,                                              BOT 1+ LDA, INY, N )Y STA,                                      POP JMP, S;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          ( fah  ) ( FOFS LREC 'CFA                                 <10/31/89>164)                                                                 0 CONSTANT FOFS \ field offset from start                       0 CONSTANT LREC \ last record address                                                                                           : 'CFA ( -- cfa, find cfa of word )                                ?FIND DROP CFA ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ( fah  ) ( RECORD: REND 'REC                              <10/31/89>165)                                                                 : RECORD:                                                         CREATE                                                           HERE TO LREC                                                    0 ,              \  0 = handle                                  0 ,              \  2 = offset                                  0 ,              \  4 = rec length                              ' <@REC> ,       \  6 = @rec                                    ' <!REC> ,       \  8 = @opr                                    0 TO FOFS                                                      DOES> ( -- record name alone returns total length )              4 + @ ;                                                                                                                                                                                                                                             ( fah  ) ( REND 'REC                                      <10/31/89>166) 0 CONSTANT (RECORD:) \ cfa of words made by RECORD:                                                                             : REND                                                             FOFS LREC 4 + ! ;                                                                                                              RECORD: TEST-REC REND  ( to get cfa for RECORD: words )         ' TEST-REC CFA @ TO (RECORD:)                                 FORGET TEST-REC                                                                                                                 : 'REC ( -- pfa, find pfa of a record )                            ?FIND DROP DUP CFA @ (RECORD:) = NOT ABORT" NOT A RECORD" ;                                                                                                                                                                                                                                                         ( fah  ) ( FIELD:                                         <10/31/89>167)                                                                 : FIELD:                                                          DEPTH 1 < ABORT" use: size FIELD: name @OPR !OPR"               CREATE IMMEDIATE ( make new word immediate )                     <@OPR> ,                  \  0 = @opr                           'CFA ,                    \  2 = @word                          <!OPR> ,                  \  4 = !opr                           'CFA ,                    \  6 = !word                          <@LOC> ,                  \  8 = @adr                           LREC ,                    \ 10 = parent record                  FOFS ,                    \ 12 = offset from start of record    DUP ,                     \ 14 = length of field                FOFS + TO FOFS                                                 DOES> 1 ABORT" @@ !! ^^ missing!" ;                                                                                  ( fah  ) ( 'FIELD F[                                      <10/31/89>168)                                                                 0 CONSTANT (FIELD:) \ cfa of words made by FIELD:                                                                                1 FIELD: TEST-FLD C@L C!L  ( to get cfa for RECORD: words )      ' TEST-FLD CFA @ TO (FIELD:)                                  FORGET TEST-FLD                                                                                                                 : 'FIELD ( -- pfa, find pfa of a field )                          ?FIND DROP DUP CFA @ (FIELD:) = NOT ABORT" NOT A FIELD" ;                                                                     : F[ ( -- n, return starting offset of field )                     'FIELD 12 + @ ;                                                                                                                                                                                                                                              ( 'FIELD DOFIELD @@ !! ^^ F[                     <10/31/89>169)                                                                 : DOFIELD ( ofs -- )                                               'FIELD + ( offset to my CFA )                                   STATE @                                                         IF , ELSE EXECUTE THEN ;                                                                                                     : @@ 0 DOFIELD ; IMMEDIATE                                      : !! 4 DOFIELD ; IMMEDIATE                                      : ^^ 8 DOFIELD ; IMMEDIATE                                                                                                                                                                                                                                                                                                                                                                                                                             ( fah  ) ( <GETHAN> <SETHAN>                              <10/31/89>170)                                                                 \ Not worth the space to redo GETLOC, hardly used               : <GETLOC> ( -- handle ofs, get handle offset of record )          R> DUP 2+ >R @ D@ SWAP ;                                                                                                     : <SETLOC> ( handle ofs -- set handle of record )                  SWAP DUP RES-VERIFY    \ load handle if needed                  R> DUP 2+ >R @ D! ;    \ set HANDLE, offset in header                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ( GETHAN SETHAN                                  <10/31/89>171)                                                                 : GETHAN ( -- seg adr , use: GETHAN rec_name )                     STATE @                                                         IF 'REC 6 + , \ compile CFA to get record handle                ELSE 'REC @ THEN                                             ; IMMEDIATE                                                                                                                     : SETHAN ( handle -- , use: handle SETHAN rec_name )               STATE @                                                         IF 'REC 8 + , \ compile CFA to set record handle                ELSE DUP RES-VERIFY 'REC ! THEN                              ; IMMEDIATE                                                                                                                                                                                                                                            ( fah  ) ( GETLOC SETLOC                                  <10/31/89>172) \ GETLOC/SETLOC are useful for setting up subscructures         \ in a single HALLOC block (although max size is 64K)                                                                           : GETLOC ( -- seg adr , use: GETLOC rec_name )                     STATE @                                                         IF COMPILE <GETLOC> 'REC ,                                      ELSE 'REC D@ SWAP THEN ; IMMEDIATE                                                                                           : SETLOC ( handle ofs -- , use: handle SETLOC rec_name )           STATE @                                                         IF COMPILE <SETLOC> 'REC ,                                      ELSE SWAP DUP RES-VERIFY 'REC D! THEN ; IMMEDIATE                                                                                                                                                                                                   ( fah  ) ( Field access operator notes                    <10/31/89>174) EXIT --------------------------------------------------                                                                         The following words allow access to different data types        than the basic @L, C@L words can provide                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ( !BUF                                           <10/31/89>174)                                                                 \ copy FLEN bytes from 1 to 2 (FLEN set by field words )        : !BUF ( seg1 adr1 seg2 adr2 -- )                                  FLEN CMOVEL ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ( fah  ) ( C@L                                            <10/31/89>176)                                                                 : SC@L ( seg adr -- b, sign extend byte on stack )                 C@L DUP 128 U< NOT  \ 128=-128, 255=-1                          IF -256 XOR THEN ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           ( B@L                                            <10/31/89>177) CREATE BPOS 1 C, 2 C, 4 C, 8 C, 16 C, 32 C, 64 C, 128 C,                                                                        CODE B@L \ bit# seg adr -- t/f, 0<=bit#<=7, bit# 0 = lsb           from_mem JSR,                                                   INX, INX, INX, INX, BOT LDA, PHA, ( save bit# )                 to_stack JSR,                                                   # 1 LDA, N 4 + STA, N 5 + STA,                                  ' transfer JSR,                                                 PLA, # 7 AND, TAY, BPOS ,Y LDA,                                 0 # LDY, BOT 1+ STY, BOT AND, 0= NOT                            IF, INY, THEN,                                                  BOT STY, NEXT JMP, C;                                                                                                                                                                                                                                        ( B!L                                            <10/31/89>177)                                                                 CODE B!L \ t/f bit# seg adr --, 0<=bit#<=7, bit# 0 = lsb           from_mem JSR,                                                   # XSAVE LDA, N 2+ STA, N 3 + STY, \ to XSAVE (RAMWRT ignored)   # 1 LDA, N 4 + STA, N 5 + STA,                                  ' transfer JSR,                   \ old value at XSAVE              \ update value                                              BOT 4 + LDA, # 7 AND, TAY, BPOS ,Y LDA, \ .A=bit mask           BOT 6 + LDY, 0=                                                 IF, # 255 EOR, XSAVE AND,                                       ELSE, XSAVE ORA, THEN,                                          XSAVE STA,                #       ######              ######             #######                                "       """""^ more...      """"""             """""""                                #       ######              ######             ####### ( B!L                                            <10/31/89>177)                                                                    \ write value back                                              # XSAVE LDA, 0 # LDY,                                           N STA, N 1+ STY,               \ from XSAVE (RAMRD ignored)     to_mem JSR,                                                     # 1 LDA, N 4 + STA, N 5 + STA,                                  ' transfer JSR,                 \ put back new value            TXA, CLC, # 8 ADC, TAX,                                         NEXT JMP, C;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ( WINDOW                                         <11/ 1/89>181)                                                                 RECORD: WINDOW                                                    2 FIELD: WN-PTR   @L  !L  \ cfa of constant that points to me   1 FIELD: WN-TYPE  C@L C!L \ window type                         2 FIELD: WN-XPOS  @L  !L  \ window upper left x (global)        2 FIELD: WN-YPOS  @L  !L  \ window upper left y (global)        2 FIELD: WN-WID   @L  !L  \ window width                        2 FIELD: WN-HT    @L  !L  \ window heigth                       1 FIELD: WN-FLAG  B@L B!L \ Window flags                        1 FIELD: WN-FADE  C@L C!L \ window fade type (0=none,1=cut)                                                                   \ more...                                                                                                                                                                                                                                              ( fah  ) ( WINDOW cont                                    <11/ 1/89>182)                                                                                                                                   2 FIELD: WN-AREAS @L  !L  \ seg of first area (0=none)          2 FIELD: WN-CWID  @L  !L  \ creating device width               2 FIELD: WN-CHT   @L  !L  \ creating device heigth              1 FIELD: WN-TED   C@L C!L \ text edit area number               1 FIELD: WN-MENU  C@L C!L \ current menu number                 1 FIELD: WN-FRAME C@L C!L \ Window frame type 0=none            2 FIELD: WN-DATA  @L   !L \ seg of any ALLOC'd data (0=NONE)                                                                  \ more...                                                                                                                                                                                                                                                                                                              ( fah  ) ( WINDOW cont                                    <11/ 2/88>  6)                                                                 \ all following field must be explicitly initialized            \ you may also copy values from existing window with WN-PCOPY     1 FIELD: WN-HCOLOR  C@L C!L \ window hilight color              1 FIELD: WN-BCOLOR  C@L C!L \ window background color           1 FIELD: WN-DCOLOR  C@L C!L \ window dull color                 1 FIELD: WN-ECOLOR  C@L C!L \ window erase color                1 FIELD: WN-PATTERN C@L C!L \ draw pattern                                                                                    \ more...                                                                                                                                                                                                                                                                                                                                                                                       ( WINDOW cont                                    <11/ 1/89>184)                                                                   1 FIELD: WN-GDOT    C@L C!L \ draw dot (brush)                  1 FIELD: WN-TFONT   C@L C!L \ text font number                  1 FIELD: WN-TMODE   C@L C!L \ text draw mode                    2 FIELD: WN-TX      @L  !L  \ text x position (global)          2 FIELD: WN-TY      @L  !L  \ text y position (global)          1 FIELD: WN-PL    SC@L C!L  \ palette for window                1 FIELD: WN-BG     C@L C!L  \ background for window                                                                                                                                           \ more...                                                                                                                                                                                                                                                                                                              ( fah  ) ( WINDOW cont                                    <11/ 1/89>185)                                                                   1 FIELD: WN-TFG   C@L C!L \ text forground color                1 FIELD: WN-TDX   C@L C!L \ text x character spacing            1 FIELD: WN-TDY   C@L C!L \ text y character spacing            1 FIELD: WN-TLHT  C@L C!L \ text line spacing (0=compute)       1 FIELD: WN-TBLHT C@L C!L \ text blank line height              1 FIELD: WN-TITAL C@L C!L \ text italics amount                 FOFS                                                              4 FIELD: WN-AUX   D@L D!L \ auxillary field for any use       TO FOFS  \ define aliase words for WN-AUX                         2 FIELD: WN-HAUX   @L  !L \ high word of WN-AUX                 2 FIELD: WN-LAUX   @L  !L \ low word of WN-AUX                                                                                                                                                                                                     ( fah  ) ( WINDOW cont                                    <11/ 1/89>186)                                                                   1 FIELD: WN-THFACE C@L C!L \ text hilit face                    1 FIELD: WN-TDFACE C@L C!L \ text dim face                      1 FIELD: WN-TEFACE C@L C!L \ text erase face                  REND                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   ( fah  ) ( WN-FLAGS bit assignments                       <11/ 1/89>187)                                                                 0 CONSTANT VISIBLE  \ T=controls in window are visable          1 CONSTANT ENABLE   \ T=controls in window are selectable       2 CONSTANT DIM      \ T=controls in window are drawn dimmed     3 CONSTANT INIT     \ T=window has not been initialized         4 CONSTANT ZOOM     \ T=window is in zoom mode                  5 CONSTANT KEYENAB  \ T=key aliases are processed               6 CONSTANT TEXTWIN  \ T=this is a text window                   \ 7 is reserved                                                 \ INIT is next flag to go                                                                                                                                                                                                                                                                                                                                                              ( fah  ) ( WN-FLAGS bit notes                             <11/ 1/89>188) EXIT -----------------------------------------------------      Bits 0-2 (VISIBLE, ENABLE, DIM) coorespond to the bits in the   AR-FLAGS field of AREA's. The window versions are ment as       global overrides values for the individual AREA's                                                                               The WN-INIT? field is used as a condition for setting initial   menu values                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ( fah  ) ( TX-COLOR TX-DX TX-DY TX-LHT TX-BLHT TX-ITAL    <11/ 6/89>189)                                                                 : TX-COLOR ( n -- ) DUP !! WN-TFG 1 AND [ TCLR ] LITERAL C! ;   : TX-DX    ( n -- ) DUP !! WN-TDX DPARAMS 24 + ! ;              : TX-DY    ( n -- ) DUP !! WN-TDY DPARAMS 26 + ! ;              : TX-LHT   ( n -- ) DUP !! WN-TLHT DPARAMS 22 + ! ;             : TX-BLHT  ( n -- ) DUP !! WN-TBLHT DPARAMS 20 + ! ;            : TX-ITAL  ( n -- ) DUP !! WN-TITAL DPARAMS 16 + ! ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ( mouse notes                                    <11/ 6/89>190) EXIT ---------------------------------------------------------                                                                  As mouse support is not currently required the relevant calls   are stubbed in.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ( fah  ) ( STUB:                                          <11/ 6/89>191)                                                                 \ defines a stub for the following word that will be skipped    \ that is stubs will not be compiled                            \ WARNING! -- Don't use on words set with ' TO etc..                                                                            : STUB:                                                            CREATE IMMEDIATE                                                DOES> DROP ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ( fah  ) ( NO-MOUSE? INIT-MOUSE                           <11/ 6/89>192)                                                                 0 CONSTANT NO-MOUSE? \ set to one to disable mouse funcitons                                                                    1 CONSTANT INIT-MOUSE \ -- T/F, T=mouse initialized and ready                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          ( fah  ) ( SHOW-MOUSE HIDE-MOUSE                          <11/ 6/89>193)                                                                 STUB: SHOW-MOUSE                                                                                                                STUB: HIDE-MOUSE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ( fah  ) ( GET-MOUSE                                      <11/ 6/89>194)                                                                 : GET-MOUSE \ -- x y but, read current mouse params               0 0 0 ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              ( fah  ) ( GDEF-MOUSE                                     <11/ 6/89>195)                                                                 : GDEF-MOUSE \ x y a --, set graphics curs w/hot spot at x y       DROP DDROP ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ( fah  ) ( ?HIDE-MOUSE                                    <11/ 6/89>196)                                                                 : ?HIDE-MOUSE ( x y x y --, hide mouse if in cord )                \ use must call SHOW-MOUSE as with SHOW-MOUSE                   \ x's are in mouse x which may be different from graphics x     DDROP DDROP ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ( fah  ) #     ##                                                                              #!!!!!##                                                                              #     ##                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ( mouse cursor notes                             <11/ 6/89>200) EXIT ---------------------------------------------------------                                                                  since there is no mouse these are just simple stubs                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ( fah  ) ( mouse cursors                                  < 7/ 2/89>  7)                                                                   STUB: 0CLOCK  \ clock cursor 0                                  STUB: 1CLOCK  \ clock cursor 1                                  STUB: 2CLOCK  \ clock cursor 2                                  STUB: 3CLOCK  \ clock cursor 3                                  STUB: POINTER \ pointer cursor                                  STUB: ER-CGA  \ CGA-erase box                                   STUB: ER-EGA  \ CGA-erase box                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ( mouse cursors                                  <11/ 6/89>202)                                                                 \ 0 CONSTANT CLOCK#                                             \ DVARIABLE LCL-TIME                                            \ 1 CONSTANT CLK-INC                                                                                                            STUB: CLOCK ( -- rotating clock cursor )                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               ( fah  )                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ( dots stubs notes                               <11/ 6/89>205) EXIT ---------------------------------------------------------                                                                  To date no show has made use o†À”ˆe dots rou¨µV]Kso I am       stubbing them in now. They can be easily added on the top       later if they are needed                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               ( fah  ) ( GR-DOT                                         <10/10/88> 23)                                                                 : GR-DOT \ N -- ; Use the Nth dot                                 DROP ;                                                                                                                        STUB: ER-DOT ( --, set erase dot )                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              ( event loop notes                               <11/ 6/89>210) EXIT ---------------------------------------------------------                                                                  The event loop, while functionaly equivelant is implemented     totally differently from the IBM                                                                                                On the IBM event are placed in a queue by interupt routines,    on the apple, each call to GET-EVENT will build an event based  on current information                                                                                                          Hopefully this change will not have major impact on the run-    time behavior of shows                                                                                                          Information about mouse status will always return false                                                                                                                                         ( EVENT RECORD                                   <11/ 6/89>211) EXIT ---------------------------------------------------------                                                                  The event record contains information about what user event     has occured.                                                                                                                     evtnum -- type of event that occured                            evtclk -- system clock when event posted                        evtp1  -- event parameter 1                                     evtp2  -- event parameter 2                                     evtflg -- event flag                                                                                                                                                                                                                                                                                                                                                                  ( fah  ) ( EVENT TYPES                                    < 9/12/88>  4) EXIT ---------------------------------------------------------                                                                  event type 0 - No event (returned if queue is empty)              evtclk: system clock                                             evtp1: mouse x pos                                              evtp2: mouse y pos                                             evtflg: mouse/key flags                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ( EVENT TYPES                                    <11/ 6/89>213) EXIT ---------------------------------------------------------  *** MOUSE EVENTS NEVER RETURNED BY APPLE VERSION ******                                                                         event type 1 - mouse left button up                                        2 - mouse left button down                                      3 - mouse right button up                                       4 - mouse right button down                            evtclk: system clock                                             evtp1: mouse x pos                                              evtp2: mouse y pos                                             evtflg: mouse/key flags                                                                                                                                                                                                                                                                                              ( fah  ) ( EVENT TYPES                                    <10/20/88>  6) EXIT ---------------------------------------------------------  event type 5 - key pressed                                        evtclk: system clock                                             evtp1: ASCII keycode                                            evtp2: scan keycode                                            evtflg: key flags                                                                                                             NOTES:                                                          **** MOUSE STATUS IS NOT RETURNED FOR KEYPRESS EVENT ****                                                                       Note ALT and CTRL no longer modify the returned values. They    just set flags (see ALT? CTRL?..) in the evtflgs.  This means   that ctrl and alt may be combined with any key that normally    generates a value. It also disables CTRL-ALT-DEL and CTRL-BREAK                                                                 ( mouse/key flags                                <11/ 6/89>215) EXIT ---------------------------------------------------------  --------------  APPLE FLAGS ARE ALWAYS ZERO!! --------------       0 - Left button down ----------+                                1 - Right button down          +---- Mouse status             2-7 - Reserved ------------------+                                8 - Right shift key pressed ---+                                9 - Left shift key pressed     |                               10 - Ctrl key pressed           |                               11 - Alt key pressed            +---- Key board status          12 - Scroll is locked           |                               13 - Num is locked              |                               14 - Caps is locked             |                               15 - Insert is locked ----------+                             **** MOUSE STATUS IS NOT RETURNED FOR KEYPRESS (5) EVENT *****                                                         ( fah  ) (                                                <11/ 6/89>216)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ( fah  ) ( ^EVENT EVENT-SIZE                              <11/ 6/89>217)                                                                 \ APPLE -- only 1 entry required                                \       -- ^EVENT removed to prevent unseen problems                                                                            11 CONSTANT EVENT-SIZE  \ size of 1 event record                                                                                                                                                CREATE EVTS     \ queue filled by interupt routines                EVENT-SIZE ALLOT                                                                                                                                                                                                                                                                                                                                                                                                                                             ( @EVTNUM @EVTCLK @EVTP1                         < 8/14/89> 11)                                                                   \ event id type                                               : @EVTNUM ( -- V ) EVTS C@ ;                                    : !EVTNUM ( -- V ) EVTS C! ;                                                                                                      \ TIMECOUNT when event was posted                             : @EVTCLK ( -- D ) EVTS 1+ D@ ;                                 : !EVTCLK ( -- D ) EVTS 1+ D! ;                                                                                                   \ event parameter 1                                           : @EVTP1  ( -- V ) EVTS 5 + @ ;                                 : !EVTP1  ( -- V ) EVTS 5 + ! ;                                                                                                                                                                                                                                 ( @EVTP2 @EVTFLG                                 <11/ 6/89>220)                                                                 : @EVTP2  ( -- V ) EVTS 7 + @ ;                                 : !EVTP2  ( -- V ) EVTS 7 + ! ;                                                                                                 : @EVTFLG ( -- V ) EVTS 9 + @ ;                                 \ !EVTFLG ( -- V ) EVTS 9 + ! ;                                                                                                 EXIT ________________________________________________________                                                                   The assmbly code will have to be updated if the event record    specification is changed!!!!!                                                                                                   APPLE -- no machine language left to update!                                                                                                                                                    ( EVTS                                           <11/ 6/89>220)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ( EVENT TYPE TESTERS                             <11/ 6/89>221)                                                                 \ APPLE -- only NULL-EVENT? and KEY-EVENT? generated!                                                                           : NULL-EVENT?    @EVTNUM 0= ;                                   : L-DOWN-EVENT?  @EVTNUM 1 = ;                                  : L-UP-EVENT?    @EVTNUM 2 = ;                                  : R-DOWN-EVENT?  @EVTNUM 3 = ;                                  : R-UP-EVENT?    @EVTNUM 4 = ;                                  : MOUSE-EVENT?   @EVTNUM 0 4 WITHIN ;                           : KEY-EVENT?     @EVTNUM 5 = ;                                                                                                  \ note some routines expect up event to be 1 more than down                                                                                                                                                                                                     ( ?KEYCODE ?SCANCODE ?FKEY                       <12/16/88> 15)                                                                 : ?KEYCODE  ( n -- T/F, T=ascii code matches )                      @EVTP1 UC= KEY-EVENT? AND ;                                                                                                 \ APPLE -- These words will never return true                   : ?SCANCODE ( n -- T/F, T=scan code matches )                      \ note -- only true when ?KEYCODE=0 or 224 (gray keys)          @EVTP2 = KEY-EVENT? AND                                         @EVTP1 0= @EVTP1 224 = OR AND ;                                                                                              : ?FKEY ( n -- T/F, true if function key number n  1<=n<=10 )      \ ignores CTRL/ALT/SHIFT keys, check if you care                1- DUP >R 59 + ?SCANCODE ( ctrl/alt code  )                     R> 84 + ?SCANCODE ( shift code ) OR ;                                                                                        ( STATUS word testers                            <11/ 6/89>223)                                                                 : ?STAT: \ use: mask ?STAT: name                                  CREATE ( mask ) ,                                               DOES> @ ( mask to match )                                        @EVTFLG AND 0= NOT ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         ( STATUS word testers                            <11/ 6/89>224) FORTH                                                           \ simple keystatus testers                                         256 ?STAT: R-SHIFT?                                             512 ?STAT: L-SHIFT?                                            1024 ?STAT: CTRL?                                               2048 ?STAT: ALT?                                                4096 ?STAT: SCROLL-LOCK?                                        8192 ?STAT: NUM-LOCK?                                          16384 ?STAT: CAPS-LOCK?                                         32768 ?STAT: INS-LOCK?                                                                                                                                                                                                                                                                                                                                                                ( fah  ) ( STATUS word testers                            <11/ 6/89>225) FORTH                                                           \ mouse status testers                                               1 ?STAT: L-BUTTON?                                              2 ?STAT: R-BUTTON?                                                                                                         \ combined testers                                                 768 ?STAT: SHIFT?                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   ( fah  ) ( FLUSH-EVENTS ?CLOSE-KEY-EVENT                  <11/ 6/89>226)                                                                 : FLUSH-EVENTS ( --, empty queue )                                 BEGIN ?TERMINAL NOT UNTIL ;                                                                                                  STUB: ?CLOSE-KEY-EVENT ( --, uninstall hook if installed )                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             ( fah  ) ( NULL-EVENT                                     <11/ 6/89>227)                                                                 : NULL-EVENT ( -- create null event )                              EVTS EVENT-SIZE 0 FILL                                          @TIMECOUNT !EVTCLK ;                                                                                                                                                                         \ APPLE -- MAKE-NULL-EVENT was removed                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ( fah  ) ( PT-EVENT                                       <11/ 6/89>228)                                                                 : PT-EVENT ( -- , set EVT record to current record )               \ if queue is empty a null event is built when the              \ first time called, otherwise point to last item               NULL-EVENT                                                      QTERM           \ is a key available?                           IF 5 !EVTNUM    \ make it into a key event                        KEY !EVTP1    \ set ASCII                                       255 !EVTP2    \ make scancode non-zero                        THEN ;                                                                                                                                                                                                                                                                                                                                                                              ( fah  ) ( GET-EVENT                                      <11/ 6/89>229)                                                                 STUB: NEXT-EVENT                                                                                                                : GET-EVENT ( -- set EVT record to point to next event )           \ wait for next tick of clock before gettin next event          BEGIN @EVTCLK @TIMECOUNT D= NOT UNTIL                           NEXT-EVENT                                                      PT-EVENT                                                     ;                                                                                                                                                                                                                                                                                                                                                                                                                                                      ( fah  ) ( GET-MOUSE-EVENT                                <11/ 6/89>230) FORTH                                                                                                                           : GET-MOUSE-EVENT \ --, set EVT to point to next mouse event       \ a mouse event is any event with mouse posistion and status    \ used mainly by tracking words                                BEGIN GET-EVENT MOUSE-EVENT?                                    UNTIL ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              ( fah  ) ( GET-KEY-EVENT                                  <11/ 6/89>231)                                                                 : GET-KEY-EVENT \ --, read till next keyboard event                \ NOTE - does not return NULL events -                          BEGIN GET-EVENT KEY-EVENT?                                      UNTIL ;                                                                                                                      : REPEAT-UNTIL ( F -- if false repeat )                            >R >R [COMPILE] UNTIL                                           R> R> 2- [COMPILE] THEN                                      ; IMMEDIATE                                                                                                                                                                                                                                                                                                                                                                                     ( @EVT-XY @EVT-KEY @EVT-CODE                     <11/ 6/89>232) FORTH                                                                                                                           : @EVT-XY ( -- x y, get coord from event record )                  @EVTP1 @EVTP2 ;                                                                                                              : @EVT-KEY ( -- n, get ASCII value of key event )                  @EVTP1 ;                                                                                                                     : @EVT-CODE ( -- n, get SCANCODE value of key event )              @EVTP2 ;                                                                                                                                                                                                                                                                                                                                                                            ( fah  ) ( GET-NEW-MOUSE-EVENT                            <11/ 6/89>233)                                                                   0 CONSTANT GNME-FLAG \ If True exit immed, resets to 0 on exit                                                                : GET-NEW-MOUSE-EVENT ( n --, stops on EVTNUM n or new pos )       >R @EVT-XY                                                      BEGIN GET-MOUSE-EVENT                                            @EVTNUM R@ = NOT GNME-FLAG 0= AND                              WHILE DDUP @EVT-XY D= NOT                                       REPEAT-UNTIL                                                    DDROP R> DROP                                                   0 TO GNME-FLAG                                               ;                                                                                                                                                                                                                                                               ( LAST-EVENT?                                    <11/ 6/89>234) FORTH                                                                                                                           : LAST-EVENT? ( -- T/F, T=current is only event in queue )         QTERM NOT ;                                                                                                                  \ if QTERM next GET-EVENT won't be null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ( fah  ) ( CLOSE-EVENT                                    <11/ 6/89>235)                                                                 STUB: CLOSE-EVENT ( --, close event handlers )                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         ( fah  ) ( INIT-EVENT                                     <11/ 6/89>236)                                                                 : INIT-EVENT ( --, initialize event handlers )                     FLUSH-EVENTS                                                    PT-EVENT ( create the first null event )                     ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      ( fah  )                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ( File stub notes                                <11/ 6/89>240) EXIT \ --------------------------------------------------------                                                                 Since all managers that need file access have been rewritten    there is no need to stub any file words                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         ( font manager notes                             <11/ 6/89>245) EXIT --------------------------------------------------------                                                                   On the apple, this package is simply required to return         the load address of the fonts, The initialization code          will load the fonts and set the table                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ( fah  ) ( VARIABLES/TABLES                               <11/ 6/89>246)                                                                   0 CONSTANT FONT:SEG  \ segment of fonts                         5 CONSTANT MAX-SETS  \ maximum # of sets that can be loaded                                                                   CREATE FONT-TABLE ( start seg for each character set)             MAX-SETS 2* ALLOT                                                                                                             : CLEAR-SETS ( -- , clear table )                                 FONT-TABLE MAX-SETS 2 * 0 FILL ;                                                                                              CLEAR-SETS                                                                                                                                                                                                                                                                                                                      ( ?FONT-NUM @CSETOFS !CSETOFS                    <11/ 6/89>247)                                                                 : ?FONT-NUM ( N --, abort if invalid font number )                 0 MAX-SETS 1- WITHIN NOT ABORT" Bad font number" ;                                                                           : @CSETOFS ( n -- ofs/0, get set offset from FONT:SEG)             DUP ?FONT-NUM 2* FONT-TABLE + @ ;                                                                                            : !CSETOFS ( ofs/0 n -- put set offset, zero means not defd)       DUP ?FONT-NUM 2* FONT-TABLE + ! ;                                                                                            \ APPLE -- @CSETHAN !CSETHAN removed as anyone using those      \          words will need rewritting                                                                                                                                                                                                                  ( fah  ) ( <TX-FONT>                                      <11/ 6/89>248)                                                                 : <TX-FONT> ( n --, switch to font n, don't change window )        ?DUP 0= IF EXIT THEN                                            DUP ?FONT-NUM                                                   DUP DPARAMS 6 + !         \ for CSIZE and CEMITS                ( n ) 2* FONT-TABLE + @   \ offset to font                      FONT:SEG SWAP  DPARAMS 2+ D!                                 ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      ( fah  ) ( TX-FONT                                        <11/ 6/89>249)                                                                 : DO-TX-FONT DROP ; \ point to <TX-FONT> to enable W                                                                            : TX-FONT ( n --, switch to font n abort if not loaded )           DUP !! WN-TFONT DO-TX-FONT ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ( fah  ) ( FONTS-INIT                                     <11/ 6/89>250)                                                                 : FONTS-INIT ( -- )                                                CLEAR-SETS -1 DPARAMS 6 + ! ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       ( fah  )                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ##                                                                                    ""                                                                                    ##                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 